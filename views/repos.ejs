<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> <!-- Corrected charset to UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Repositories - GitHub Deployer</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Your GitHub Repos</h1>
            <nav>
                <% if (isAuthenticated && user) { %>
                    <img src="<%= user.avatar_url %>" alt="<%= user.login %> Avatar" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 8px; border: 1px solid #00FFFF;">
                    <span><%= user.login %></span>
                    <a href="/auth/logout" class="btn">Logout</a>
                <% } else { %>
                    <a href="/" class="btn">Home</a>
                <% } %>
            </nav>
        </header>

        <% if (typeof error !== 'undefined' && error) { %>
            <p class="error-message"><%= error %></p>
        <% } %>

        <div id="repo-list">
            <% if (repos && repos.length > 0) { %>
                <ul>
                    <% repos.forEach(repo => { %>
                        <li>
                            <div class="repo-info">
                                <h3><a href="<%= repo.html_url %>" target="_blank" title="View on GitHub"><%= repo.name %></a></h3>
                                <p><%= repo.description ? repo.description : 'No description provided.' %></p>
                                <small>Last updated: <%= new Date(repo.updated_at).toLocaleDateString() %></small>
                            </div>
                            <button class="btn deploy-btn" data-repo-name="<%= repo.name %>" data-repo-full-name="<%= repo.full_name %>">
                                Deploy
                            </button>
                        </li>
                    <% }); %>
                </ul>
            <% } else if (isAuthenticated && (!repos || repos.length === 0) && (!error)) { %>
                <p>No repositories found for your account, or they are still loading. You can try <a href="javascript:location.reload()">refreshing</a> the page.</p>
            <% } else if (!isAuthenticated) { %>
                <p>Please <a href="/auth/github">login with GitHub</a> to see your repositories.</p>
            <% } %>
        </div>
        <div id="deployment-status" style="margin-top: 20px; padding: 10px; border-radius: 5px; text-align: center;"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const deployButtons = document.querySelectorAll('.deploy-btn');
            const statusDiv = document.getElementById('deployment-status');

            deployButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const repoName = event.target.dataset.repoName;

                    // Disable button and show loading text
                    event.target.disabled = true;
                    event.target.textContent = 'Deploying...';
                    statusDiv.textContent = \`Initiating deployment for \${repoName}...\`;
                    statusDiv.style.backgroundColor = '#00FFFF20'; // Light cyan background
                    statusDiv.style.color = '#00FFFF'; // Cyan text

                    // Simulate deployment delay
                    setTimeout(() => {
                        // Re-enable button and show success message
                        event.target.disabled = false;
                        event.target.textContent = 'Deploy';
                        statusDiv.textContent = \`âœ… Successfully initiated deployment for \${repoName}!\`;
                        statusDiv.style.backgroundColor = '#00FF0020'; // Light green background
                        statusDiv.style.color = '#00FF00'; // Green text

                        // Optionally, clear the message after some time
                        setTimeout(() => {
                            statusDiv.textContent = '';
                            statusDiv.style.backgroundColor = 'transparent';
                        }, 5000);

                    }, 2500); // 2.5 seconds delay
                });
            });
        });
    </script>
</body>
</html>
